version: 1.8.0.{build}
image: Visual Studio 2017
pull_requests:
  do_not_increment_build_number: true
configuration: Release
before_build:
- cmd: curl -L "https://www.nuget.org/api/v2/package/TensorFlowSharp/1.4.0-pre1" -o native.nuget
- cmd: 7z x native.nuget
- cmd: dotnet restore
build:
  verbosity: minimal
test_script:
- cmd: dotnet test -c Release --no-build tests\TensorFlowSharp.Tests\TensorFlowSharp.Tests.fsproj
- cmd: dotnet test -c Release --no-build tests\TensorFlowSharp.Tests.CSharp\TensorFlowSharp.Tests.CSharp.csproj
after_test:
- choco install opencover.portable
- choco install codecov
- OpenCover.Console.exe -register:user -target:"C:\Program Files\dotnet\dotnet.exe" -targetargs:"test -c Release --no-build --verbosity q tests\TensorFlowSharp.Tests.CSharp\TensorFlowSharp.Tests.CSharp.csproj"
- codecov -f "results.xml" 
artifacts:
- path: '**\*.nupkg'
